# Лабораторная 4: Числа с плавающей точкой (С)


### Вступительное слово

Любые расчеты в вычислительной математике идут через числа с плавающей точкой. 
Большинство проблем, которые при этом возникают, уходят корнями в то, что эти числа не соответствуют в точности диапазону действительных чисел.
Числа с плавающей точкой - это конечный дискретный набор чисел, который только имитирует действительные с некоторой точностью.
Чтобы грамотно проводить расчеты, нужно это понимать.
Детально.

В этой лабораторной мы смотрим на них, в основном средствами C/C++ - как они устроены и к каким проблемам приводят их недостатки.
В следующей мы поговорим про ассемблер, вопросы оптимизации и ускорения расчетов.

### Отчётность и формальные моменты

Отчет по лабе состоит из двух разделов (нумерация с нуля, раз уж так начали). 

Нулевой раздел обязательный, в нем нужно посмотреть своими руками базу по флоатам. 

Первый раздел на выбор - Путь Геометра или Путь Художника. 
В обоих случаях, отчет будет похож на научную статью. 
Там не нужно кода, только графики или скриншоты расчетов.

## Задания

### Нулевой раздел. Стуктура float.

При необходимости, освежите в памяти материал первого семестра [о внутреннем устройстве чисел с плавающей точкой](https://youtu.be/DJbiaxKAs9c?list=PLecy9mZ2ycLK4kjnS2SXSUVY2w044lxGd&t=3532).

1. Выведите на экран переменные типа unsigned int и int в том виде, в котором они хранятся в памяти. Рекомендуется использовать ассемблерную вставку, сдвиги и флаг CF.
2. Выведите на экран переменные типа float и double в том виде, в котором они хранятся в памяти (в т.ч. NaN, нули и бесконечности). Рекомендуется использовать код из прошлого пункта.
3. Напишите код на С/С++, демонстрирующий эффект переполнения мантиссы. Как это сделать одним присвоением?
4. Напишите код на С/С++, демонстрирующий неассоциативность арифметических операций.
5. Напишите код на С/С++, демонстрирующий эффект антипереполнения. Определите минимальное положительное число, которым может оперировать компьютер для типов float и double. Проверьте, поддерживает ли ваш сопроцессор денормализованные числа.
6. Сравните производительность работы сопроцессора на нормализованных и денормализованных числах. Разберитесь, чем отличаются флаги DAZ и FTZ. Эти флаги в С/С++ можно включать так:
```
#include <xmmintrin.h>
/* enable DAZ (denormals are zero) and FTZ (flush to zero) */
_mm_setcsr(_mm_getcsr() | 0x8040);
/* disable DAZ and FTZ */
_mm_setcsr(_mm_getcsr() & ~0x8040);
```

### Путь Геометра

1. Возьмите функцию, для которой можете аналитически посчитать площадь под графиком на отрезке от 0 до 1. 
*Например, хорошо подойдет y = x.*
Посчитайте эту площадь методом прямоугольников.
2. Постройте график зависимости значения площади от количества прямоугольников. 
*Можно также сравнить правых прямоугольников и левых прямоугольников.*
3. Посчитайте ту же площадь методом трапеций. 
Постройте график зависимости значения площади от количества трапеций.
4. Возьмите более сложную функцию (квадратичную, синус, площадь четверти круга...) и проделайте для нее то же самое.

### Путь Художника

Если вы освоились с графическими библиотеками и искали повод поделать что-то с ними, то поздравляем.

Решите численно задачу двух тел методом Ньютона и сделайте к ней визуализацию.

Возьмите два тела разной массы, которые крутятся по стационарным орбитам вокруг общего центра масс.
Метод Ньютона - это простой численный метод (первого порядка), который в данном случае выглядит так:
0. Задаются начальные координаты и скорости тел. Задается шаг по времени.
1. По координатам высчитываются гравитационные силы, которые действуют на оба тела.
2. По силам высчитываются ускорения (второй закон Ньютона).
3. По ускорениям высчитываются изменения скорости за текущий шаг по времени.
4. По обновленным скоростям высчитываются новые координаты - куда улетели тела за тот же шаг по времени. 
5. Возвращаемся на шаг 1. 

Сделайте визуализацию. 
*Если все формулы вроде правильные, но тела все равно куда-то улетают, уменьшите шаг по времени.
Очень сильно, на несколько порядков.*

Как вы понимаете, если выписать и визуализировать аналитическое решение этой задачи, тела должны двигаться по фиксированным эллиптическим орбитам.
Вам нужно исследовать поведение численного решения в зависимости от шага по времени. 
Вначале глазами, потом более точно.
Для этого лучше всего строить графики - например, зависимость среднего отклонения от аналитического решения за оборот в зависимости от номера оборота.
Постройте такие графики для разных значений шага по времени.

*Если все получилось и оказалось слишком просто, попробуйте помимо метода Ньютона реализовать более сложные вычислительные методы - например, Верле или Рунге-Кутты.*
